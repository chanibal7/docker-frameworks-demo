<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Jan 6, 2012 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>
        Apache Synapse - Sample 156</title>
    <style type="text/css" media="all">
      @import url("../../css/maven-base.css");
      @import url("../../css/maven-theme.css");
      @import url("../../css/site.css");
    </style>
    <link rel="stylesheet" href="../../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20120106" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                Apache Synapse
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2012-01-06</span>
                  &nbsp;| <span id="projectVersion">Version: 2.1.0</span>
                      </div>
            <div class="xright">        
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                <h5>Main Menu</h5>
                  <ul>
                  <li class="none">
                          <a href="../../index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="../../download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="../../history.html" title="History">History</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/licenses/LICENSE-2.0" class="externalLink" title="License">License</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks">Thanks</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship">Sponsorship</a>
            </li>
                  <li class="none">
                          <a href="http://www.apache.org/security/" class="externalLink" title="Security">Security</a>
            </li>
          </ul>
                       <h5>Documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="../../userguide/installation.html" title="Installation Guide">Installation Guide</a>
            </li>
                  <li class="none">
                          <a href="../../userguide/quick_start.html" title="Quick Start Guide">Quick Start Guide</a>
            </li>
                  <li class="none">
                          <a href="../../userguide/samples/setup/index.html" title="Samples Setup Guide">Samples Setup Guide</a>
            </li>
                  <li class="none">
                          <a href="../../userguide/samples.html" title="Samples Catalog">Samples Catalog</a>
            </li>
                  <li class="none">
                          <a href="../../userguide/config.html" title="Configuration Language">Configuration Language</a>
            </li>
                  <li class="none">
                          <a href="../../userguide/mediators.html" title="Mediators Catalog">Mediators Catalog</a>
            </li>
                  <li class="none">
                          <a href="../../userguide/transports.html" title="Transports Catalog">Transports Catalog</a>
            </li>
                  <li class="none">
                          <a href="../../userguide/extending.html" title="Extending Synapse">Extending Synapse</a>
            </li>
                  <li class="none">
                          <a href="../../userguide/upgrading.html" title="Upgrading">Upgrading</a>
            </li>
                  <li class="none">
                          <a href="../../userguide/deployment.html" title="Deployment">Deployment</a>
            </li>
                  <li class="none">
                          <a href="../../apidocs/" title="Javadocs">Javadocs</a>
            </li>
                  <li class="none">
                          <a href="../../userguide/faq.html" title="FAQ">FAQ</a>
            </li>
          </ul>
                       <h5>Developer Resources</h5>
                  <ul>
                  <li class="none">
                          <a href="../../dev/developer-guide.html" title="Developer Guide">Developer Guide</a>
            </li>
                  <li class="none">
                          <a href="../../dev/best-practices.html" title="Development Best Practices">Development Best Practices</a>
            </li>
                  <li class="none">
                          <a href="../../dev/release-process.html" title="Release Process">Release Process</a>
            </li>
          </ul>
                       <h5>Project Details</h5>
                  <ul>
                  <li class="none">
                          <a href="../../project-info.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../../mail-lists.html" title="Mailing Lists">Mailing Lists</a>
            </li>
                  <li class="none">
                          <a href="../../source-repository.html" title="Source Repository">Source Repository</a>
            </li>
                  <li class="none">
                          <a href="../../issue-tracking.html" title="Issue Tracking">Issue Tracking</a>
            </li>
                  <li class="none">
                          <a href="../../dependencies.html" title="Dependencies">Dependencies</a>
            </li>
                  <li class="none">
                          <a href="../../team-list.html" title="Project Team">Project Team</a>
            </li>
                  <li class="none">
                          <a href="../../project-summary.html" title="Project Summary">Project Summary</a>
            </li>
          </ul>
                       <h5>Previous Releases</h5>
                  <ul>
                  <li class="none">
                          <a href="../../1_2/docs_index.html" title="Version 1.2">Version 1.2</a>
            </li>
                  <li class="none">
                          <a href="../../1_1_1/content.html" title="Version 1.1.1">Version 1.1.1</a>
            </li>
                  <li class="none">
                          <a href="../../1_1/content.html" title="Version 1.1">Version 1.1</a>
            </li>
                  <li class="none">
                          <a href="../../1_0/content.html" title="Version 1.0">Version 1.0</a>
            </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" />
      </a>
                   
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!-- ~  Licensed to the Apache Software Foundation (ASF) under one
  ~  or more contributor license agreements.  See the NOTICE file
  ~  distributed with this work for additional information
  ~  regarding copyright ownership.  The ASF licenses this file
  ~  to you under the Apache License, Version 2.0 (the
  ~  "License"); you may not use this file except in compliance
  ~  with the License.  You may obtain a copy of the License at
  ~
  ~   http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing,
  ~  software distributed under the License is distributed on an
  ~   * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~  KIND, either express or implied.  See the License for the
  ~  specific language governing permissions and limitations
  ~  under the License. -->
    
        <div class="section"><h2>Sample 156: Service Integration with Specifying the Receiving Sequence<a name="Sample_156:_Service_Integration_with_Specifying_the_Receiving_Sequence"></a></h2>
            <div class="xmlConf">&lt;definitions xmlns=&quot;http://ws.apache.org/ns/synapse&quot;&gt;
    &lt;localEntry key=&quot;sec_policy&quot; src=&quot;file:repository/conf/sample/resources/policy/policy_3.xml&quot;/&gt;
    &lt;proxy name=&quot;StockQuoteProxy&quot;&gt;
        &lt;target&gt;
            &lt;inSequence&gt;
                &lt;enrich&gt;
                    &lt;source type=&quot;body&quot;/&gt;
                    &lt;target type=&quot;property&quot; property=&quot;REQUEST&quot;/&gt;
                &lt;/enrich&gt;

                &lt;send receive=&quot;SimpleServiceSeq&quot;&gt;
                    &lt;endpoint name=&quot;secure&quot;&gt;
                        &lt;address uri=&quot;http://localhost:9000/services/SecureStockQuoteService&quot;&gt;
                            &lt;enableSec policy=&quot;sec_policy&quot;/&gt;
                        &lt;/address&gt;
                    &lt;/endpoint&gt;
                &lt;/send&gt;
            &lt;/inSequence&gt;
            &lt;outSequence&gt;
                &lt;drop/&gt;
            &lt;/outSequence&gt;
        &lt;/target&gt;
    &lt;/proxy&gt;

    &lt;sequence name=&quot;SimpleServiceSeq&quot;&gt;
        &lt;property name=&quot;SECURE_SER_AMT&quot; expression=&quot;//ns:getQuoteResponse/ns:return/ax21:last&quot;
                  xmlns:ns=&quot;http://services.samples&quot; xmlns:ax21=&quot;http://services.samples/xsd&quot;/&gt;
        &lt;log level=&quot;custom&quot;&gt;
            &lt;property name=&quot;SecureStockQuoteService-Amount&quot; expression=&quot;get-property('SECURE_SER_AMT')&quot;/&gt;
        &lt;/log&gt;
        &lt;enrich&gt;
            &lt;source type=&quot;body&quot;/&gt;
            &lt;target type=&quot;property&quot; property=&quot;SecureService_Res&quot;/&gt;
        &lt;/enrich&gt;
        &lt;enrich&gt;
            &lt;source type=&quot;property&quot; property=&quot;REQUEST&quot;/&gt;
            &lt;target type=&quot;body&quot;/&gt;
        &lt;/enrich&gt;
        &lt;send receive=&quot;ClientOutSeq&quot;&gt;
            &lt;endpoint name=&quot;SimpleStockQuoteService&quot;&gt;
                &lt;address uri=&quot;http://localhost:9000/services/SimpleStockQuoteService&quot;/&gt;
            &lt;/endpoint&gt;
        &lt;/send&gt;
    &lt;/sequence&gt;

    &lt;sequence name=&quot;ClientOutSeq&quot;&gt;
        &lt;property name=&quot;SIMPLE_SER_AMT&quot; expression=&quot;//ns:getQuoteResponse/ns:return/ax21:last&quot;
                  xmlns:ns=&quot;http://services.samples&quot; xmlns:ax21=&quot;http://services.samples/xsd&quot;/&gt;
        &lt;log level=&quot;custom&quot;&gt;
            &lt;property name=&quot;SimpleStockQuoteService-Amount&quot; expression=&quot;get-property('SIMPLE_SER_AMT')&quot;/&gt;
        &lt;/log&gt;
        &lt;enrich&gt;
            &lt;source type=&quot;body&quot;/&gt;
            &lt;target type=&quot;property&quot; property=&quot;SimpleService_Res&quot;/&gt;
        &lt;/enrich&gt;

        &lt;filter xpath=&quot;fn:number(get-property('SIMPLE_SER_AMT')) &gt; fn:number(get-property('SECURE_SER_AMT'))&quot;&gt;
            &lt;then&gt;
                &lt;log&gt;
                    &lt;property name=&quot;StockQuote&quot; value=&quot;SecureStockQuoteService&quot;/&gt;
                &lt;/log&gt;
                &lt;enrich&gt;
                    &lt;source type=&quot;property&quot; property=&quot;SecureService_Res&quot;/&gt;
                    &lt;target type=&quot;body&quot;/&gt;
                &lt;/enrich&gt;
            &lt;/then&gt;
            &lt;else&gt;
                &lt;log&gt;
                    &lt;property name=&quot;StockQuote&quot; value=&quot;SimpleStockQuoteService&quot;/&gt;
                &lt;/log&gt;
            &lt;/else&gt;
        &lt;/filter&gt;
        &lt;send/&gt;
    &lt;/sequence&gt;
&lt;/definitions&gt;</div>
            <div class="section"><h3>Objective<a name="Objective"></a></h3>
                <p>
                    Synapse is capable of mediating requests among multiple services and managing
                    complex message flows thereby acting as a lightweight orchestration engine. This
                    sample demonstrates how to easily integrate multiple services with Synapse using
                    the 'receiving sequence' feature of Synapse.
                </p>
            </div>
            <div class="section"><h3>Pre-requisites<a name="Pre-requisites"></a></h3>
                <p>
                    </p><ul>
                        <li>
                            Deploy the SimpleStockQuoteService in the sample Axis2 server
                        </li>
                        <li>
                            Deploy the SecureStockQuoteService in the sample Axis2 server and start Axis2
                        </li>
                        <li>
                            Start Synapse using the configuration numbered 156 (repository/conf/sample/synapse_sample_156.xml)
                            <div class="command">
                                Unix/Linux: sh synapse.sh -sample 156<br />
                                Windows: synapse.bat -sample 156
                            </div>
                        </li>
                    </ul>
                
            </div>
            <div class="section"><h3>Executing the Client<a name="Executing_the_Client"></a></h3>
                <p>
                    This sample includes a proxy service which first forwards the client request to
                    the SecureStockQuoteService. Once a response has been received from this service,
                    Synapse will turn around and invoke the SimpleStockQuoteService. To do this proxy
                    service must hold on to the original request in memory. This is done using an
                    enrich mediator. Once Synapse has received a response from the SimpleStockQuoteService
                    it will compare the two responses received from the two services and select the
                    one with the lower stock quote value. This response will be then sent to the
                    client.
                </p>
                <p>
                    The important feature to note here is the 'receive' attribute set on the 'send'
                    mediators. This tells Synapse that responses of those send operations should be
                    directed to the sequences referred by the 'receive' attribute. Therefore the
                    response from the SecureStockQuoteService is directed to the sequence named
                    'SimpleServiceSeq'. Similarly the response from the SimpleStockQuoteService will
                    be handled by the sequence named 'ClientOutSeq'.
                </p>
                <p>
                    To try this out, execute the stock quote client as follows:
                </p>
                <div class="command">ant stockquote -Daddurl=http://localhost:8280/services/StockQuoteProxy</div>
                <p>
                    You can confirm that Synapse invokes both services by going through the console
                    output of the Axis2 server. However Axis2 client will receive only one response
                    back. As far as  the client is concerned, only one HTTP transaction is taking place.
                    But Synapse does multiple service invocations with the back-end to make the whole
                    integration scenario tick.
                </p>
            </div>
        </div>
        <p><a href="../samples.html">Back to Catalog</a></p>
    

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2005-2012
                        <a href="http://www.apache.org/">Apache Software Foundation</a>.
            All Rights Reserved.      
        
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
